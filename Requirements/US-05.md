# User Story US-05: Automatic Receipt Generation

## User Story Description

**ID:** US-05

**Priority:** High

**User Story:**
As a **Cashier**, I want to **automatically generate a ticket/receipt for each transaction** so that **customers receive proof of purchase and all sales are documented**.

---

## Detailed Conversation

### Context
The Toscana Manager 2.0 system must generate professional, accurate receipts for every transaction. Receipts serve as proof of purchase for customers, support warranty claims and returns, and create an essential audit trail for the business. They must comply with legal requirements and include all necessary tax and transaction information.

### User Needs
**Cashier:** "Every time I complete a sale, the customer expects a receipt. It needs to happen automatically without me having to remember to print it. Some customers want a printed receipt, others prefer it emailed or texted to them."

**System Analyst:** "What information must appear on every receipt?"

**Cashier:** "The basics are:
- Store/branch name and address
- Date and time of purchase
- List of items purchased with prices
- Subtotal, tax, and total amount
- Payment method used
- A unique transaction number
- Our return policy or a reference to it"

**Branch Manager:** "From a business perspective, receipts are critical for compliance. We need to meet legal requirements for receipts in our jurisdiction. This includes:
- Tax identification number
- Sequential receipt numbering for audit purposes
- Tax breakdown (showing tax rate and amount)
- Employee/cashier identification (for accountability)"

**System Analyst:** "What format options do customers expect?"

**Cashier:** "Most want a printed receipt, but increasingly customers ask for:
- Email receipts (so they don't lose the paper)
- Digital receipts via SMS/text
- No receipt at all (some customers decline for environmental reasons)

We should ask the customer their preference at checkout."

**System Analyst:** "What details should appear for each item on the receipt?"

**Cashier:** "For each item, I need:
- Item name/description
- Quantity
- Individual price
- Any modifiers or special instructions (like 'no onions' for food items)
- Any discounts applied to that specific item
- Line total (quantity Ã— price - discounts)"

**Branch Manager:** "We also need to show taxes clearly. In some jurisdictions, we need to break down different tax rates if items have different tax categories."

**System Analyst:** "How should the receipt handle split payments?"

**Cashier:** "If a customer pays with multiple methods, the receipt needs to show each payment method separately. For example:
- Cash: $50.00
- Credit Card (Visa ****1234): $50.00
- Total Paid: $100.00"

**System Analyst:** "What about discounts on the receipt?"

**Branch Manager:** "Each discount should be clearly shown:
- The discount name/description
- The discount amount or percentage
- Whether it applies to specific items or the total

This transparency helps customers understand their savings and builds trust."

**System Analyst:** "Should receipts include any promotional or marketing information?"

**Branch Manager:** "Yes, we'd like to include:
- A thank you message
- Information about our loyalty program
- QR code for customer feedback survey
- Upcoming promotions or events
- Social media handles

But the primary transaction information should always be clear and prominent."

**Cashier:** "What if the receipt printer is out of paper or broken?"

**System Analyst:** "Good question. What's the fallback?"

**Branch Manager:** "The transaction should still complete and be recorded in the system. The receipt should be automatically stored digitally, and we should be able to:
- Reprint it later when the printer is fixed
- Email it to the customer instead
- View it on screen to show the customer

The system should alert the cashier if the printer has an issue."

**System Analyst:** "Do you need different receipt formats for different transaction types?"

**Branch Manager:** "Yes:
- **Standard sales** get the normal receipt
- **Returns/refunds** should clearly mark the receipt as 'REFUND' and show the original transaction reference
- **Void transactions** should print a void receipt for record-keeping
- **Table orders** (for dine-in) might have a different format showing table number and server"

**Cashier:** "Sometimes customers lose their receipt and come back asking for a duplicate. Can we reprint?"

**Branch Manager:** "Yes, but reprints should be clearly marked as 'DUPLICATE' or 'COPY' to prevent fraudulent returns. We should log who reprinted it and when."

### Business Value
- **Legal Compliance:** Meets tax and regulatory requirements for transaction documentation
- **Customer Service:** Provides customers with proof of purchase for returns and warranties
- **Audit Trail:** Creates complete record of all transactions for accounting and auditing
- **Dispute Resolution:** Helps resolve customer complaints or payment disputes
- **Marketing Opportunity:** Allows inclusion of promotional content and loyalty program information
- **Operational Transparency:** Builds customer trust through clear transaction details

---

## Acceptance Criteria (Gherkin Style)

### Scenario 1: Generate Standard Receipt for Cash Sale
```gherkin
Feature: Automatic Receipt Generation
  As a Cashier
  I want to automatically generate receipts for each transaction
  So that customers receive proof of purchase and all sales are documented

Scenario: Automatically generate and print receipt after cash sale
  Given I am logged in as a Cashier at branch "Toscana Downtown"
  And the branch address is "123 Main St, City, State 12345"
  And the tax ID is "TAX-123456789"
  And I have completed a sale with the following items:
    | Item              | Quantity | Unit Price | Line Total |
    | Margherita Pizza  | 2        | $12.00     | $24.00     |
    | Caesar Salad      | 1        | $8.00      | $8.00      |
    | Soft Drink        | 2        | $3.00      | $6.00      |
  And the subtotal is $38.00
  And the tax (8%) is $3.04
  And the total is $41.04
  And the customer paid with cash ($50.00)
  And the change is $8.96
  When the sale is completed
  Then the system should automatically generate a receipt
  And the receipt should be sent to the printer
  And the receipt should include:
    | Section              | Content                          |
    | Branch Name          | Toscana Downtown                 |
    | Branch Address       | 123 Main St, City, State 12345   |
    | Tax ID               | TAX-123456789                    |
    | Transaction ID       | TXN-20260202-001234              |
    | Date/Time            | 2026-02-02 14:04:53              |
    | Cashier              | [Cashier Name/ID]                |
    | Items List           | [All items with details]         |
    | Subtotal             | $38.00                           |
    | Tax (8%)             | $3.04                            |
    | Total                | $41.04                           |
    | Payment Method       | Cash                             |
    | Cash Tendered        | $50.00                           |
    | Change               | $8.96                            |
  And the receipt should be stored in the system database
```

### Scenario 2: Generate Receipt with Discount Information
```gherkin
Scenario: Receipt clearly shows applied discounts
  Given I have completed a sale with subtotal $100.00
  And a "Loyalty Program" discount of 10% ($10.00) was applied
  And a "Manager Discretion" discount of $5.00 was applied with authorization
  And the adjusted subtotal is $85.00
  And tax (8%) is $6.80
  And the total is $91.80
  When the receipt is generated
  Then the receipt should show:
    | Line Item                              | Amount    |
    | Subtotal                               | $100.00   |
    | Discount: Loyalty Program (10%)        | -$10.00   |
    | Discount: Manager Discretion           | -$5.00    |
    | Subtotal after discounts               | $85.00    |
    | Tax (8%)                               | $6.80     |
    | Total                                  | $91.80    |
  And each discount should be itemized separately
  And the total savings should be highlighted ($15.00)
```

### Scenario 3: Generate Receipt with Split Payment
```gherkin
Scenario: Receipt shows multiple payment methods
  Given I have completed a sale totaling $150.00
  And the customer paid with:
    | Payment Method           | Amount    | Details           |
    | Cash                     | $50.00    | -                 |
    | Credit Card (Visa)       | $100.00   | ****4321          |
  When the receipt is generated
  Then the payment section should show:
    | Payment Details                    |
    | Cash: $50.00                       |
    | Credit Card (Visa ****4321): $100.00 |
    | Total Paid: $150.00                |
  And both payment methods should be clearly itemized
```

### Scenario 4: Create Digital Receipt via Email
```gherkin
Scenario: Customer requests email receipt instead of printed
  Given I have completed a sale totaling $75.00
  And the sale is ready to be finalized
  When I ask the customer for receipt preference
  And the customer provides their email "customer@example.com"
  And selects "Email Receipt"
  Then the system should generate a digital receipt
  And send it to "customer@example.com"
  And the email should have subject "Your Receipt from Toscana Downtown"
  And the email should contain the full receipt details in HTML format
  And the receipt should also be attached as a PDF
  And the system should display "Receipt sent to customer@example.com"
  And no physical receipt should be printed
  And the transaction should be marked as "Digital Receipt - Email"
```

### Scenario 5: Handle Receipt Printer Failure
```gherkin
Scenario: Complete transaction when receipt printer is offline
  Given I have completed a sale totaling $60.00
  And the receipt printer is out of paper
  When the system attempts to print the receipt
  Then the system should detect the printer error
  And display warning "Printer offline - Receipt not printed"
  And the transaction should still be completed and saved
  And the system should offer options:
    | Option                           |
    | Email receipt to customer        |
    | Mark for reprint when available  |
    | Show receipt on screen           |
  And the receipt should be stored digitally for later retrieval
  And the printer error should be logged
```

### Scenario 6: Generate Refund Receipt
```gherkin
Scenario: Receipt for refund transaction is clearly marked
  Given a customer is returning items from transaction "TXN-20260201-005678"
  And the original sale was $120.00
  And the refund amount is $120.00
  And the refund was authorized by the Branch Manager
  When the refund transaction is completed
  Then the system should generate a refund receipt
  And the receipt header should display "REFUND RECEIPT" prominently
  And the receipt should include:
    | Field                    | Value                     |
    | Receipt Type             | REFUND                    |
    | Original Transaction     | TXN-20260201-005678       |
    | Original Date            | 2026-02-01                |
    | Refund Transaction ID    | REF-20260202-001240       |
    | Refund Date              | 2026-02-02                |
    | Refund Amount            | $120.00                   |
    | Refund Method            | Credit Card (****1234)    |
    | Authorized By            | [Manager Name/ID]         |
  And the refund receipt should reference the original receipt
```

### Scenario 7: Reprint Receipt as Duplicate
```gherkin
Scenario: Customer requests duplicate receipt
  Given a transaction "TXN-20260202-001234" was completed yesterday
  And the original receipt was printed
  And a customer returns requesting a copy of their receipt
  When I search for transaction "TXN-20260202-001234"
  And I select "Reprint Receipt"
  And I confirm the reprint action
  Then the system should generate a duplicate receipt
  And the receipt should be marked "DUPLICATE RECEIPT" at the top
  And the receipt should contain all original transaction details
  And the reprint should show:
    | Field                | Value                     |
    | Original Date        | 2026-02-01                |
    | Reprinted Date       | 2026-02-02                |
    | Reprinted By         | [Cashier Name/ID]         |
  And the reprint action should be logged in the audit trail
```

### Scenario 8: Include Item Modifiers and Special Instructions
```gherkin
Scenario: Receipt shows item customizations
  Given I have completed a sale with customized items:
    | Item                | Quantity | Price  | Modifiers/Instructions          |
    | Margherita Pizza    | 1        | $12.00 | Extra cheese, No basil          |
    | Caesar Salad        | 1        | $8.00  | Dressing on side, Add chicken   |
  And the total is $20.00 (excluding tax)
  When the receipt is generated
  Then each item should show its modifiers:
    """
    Margherita Pizza                    $12.00
      - Extra cheese
      - No basil
      
    Caesar Salad                        $8.00
      - Dressing on side
      - Add chicken
    """
  And modifiers should be indented under each item for clarity
```

### Scenario 9: Include Marketing and Promotional Content
```gherkin
Scenario: Receipt includes loyalty program and promotional information
  Given the branch has configured the following receipt footer content:
    | Content Type           | Details                                |
    | Thank You Message      | Thank you for dining at Toscana!       |
    | Loyalty Program        | Join our rewards program - Ask staff   |
    | Feedback QR Code       | [QR Code URL to survey]                |
    | Social Media           | Follow us @ToscanaRestaurant           |
    | Next Promotion         | Happy Hour: Mon-Fri 4-6 PM, 20% off    |
  When a receipt is generated
  Then the receipt should include a footer section with all promotional content
  And the promotional content should appear after the transaction details
  And the QR code should be renderable for scanning
  And the footer should be visually separated from transaction details
```

### Scenario 10: Generate Receipt for Table Order (Dine-In)
```gherkin
Scenario: Receipt for dine-in table order includes server and table information
  Given a customer is paying for table "T-12"
  And the server was "Maria Garcia"
  And the items ordered total $85.00
  And a 15% tip of $12.75 was added
  And the final total is $97.75
  When the payment is completed
  Then the receipt should include:
    | Field              | Value                |
    | Service Type       | Dine-In              |
    | Table Number       | T-12                 |
    | Server             | Maria Garcia         |
    | Subtotal          | $85.00               |
    | Tax (8%)          | $6.80                |
    | Tip (15%)         | $12.75               |
    | Total             | $97.75               |
  And the receipt should thank the customer for dining in
  And server information should be prominently displayed
```

---
