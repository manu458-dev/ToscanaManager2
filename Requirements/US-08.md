# User Story US-08: Automatic Weekly Reports

## User Story Description

**ID:** US-08

**Priority:** High

**User Story:**
As a **General Director**, I want to **automatically receive weekly reports per branch and consolidated corporate reports** so that **I can make informed strategic decisions without manual consolidation**.

---

## Detailed Conversation

### Context
The Toscana Manager 2.0 system must provide comprehensive automated reporting to support strategic decision-making at the corporate level. The General Director needs visibility into both individual branch performance and consolidated corporate metrics without manual data gathering or spreadsheet manipulation. Weekly reports should be generated automatically and delivered in formats suitable for analysis and sharing with stakeholders.

### User Needs
**General Director:** "Every week, I need to review how the business is performing. Currently, I have to ask each Branch Manager for their numbers and manually combine them in spreadsheets. This takes hours and is error-prone. I want the system to automatically generate and send me these reports."

**System Analyst:** "What specific information do you need in the weekly reports?"

**General Director:** "I need to see several key metrics:
- **Sales performance:** Total sales per branch and consolidated across all branches
- **Sales trends:** Comparison to previous weeks and same period last year
- **Payment method breakdown:** How much was cash vs. card payments
- **Top-performing products:** What's selling well at each branch
- **Average transaction value:** Are customers spending more or less?
- **Discount usage:** How much are we giving away in discounts?
- **Variance and exceptions:** Any unusual patterns or problems I should know about"

**System Analyst:** "Should you receive separate reports for each branch plus a consolidated report?"

**General Director:** "Yes, exactly. I want:
- Individual weekly reports for each of the 12 branches
- A consolidated corporate report that summarizes all branches
- The ability to compare branches side-by-side

All of these should be generated automatically every Monday morning for the previous week (Monday-Sunday)."

**System Analyst:** "What format do you prefer for these reports?"

**General Director:** "I need multiple formats:
- **PDF** for reading and printing - this is my primary format for review
- **Excel/CSV** for detailed analysis and sharing with my finance team
- **Email delivery** so they arrive in my inbox without me having to log in
- **Dashboard view** in the system when I want to drill into specifics

The email should include an executive summary with key highlights and the full reports as attachments."

**System Analyst:** "What should happen if there are significant issues or anomalies?"

**General Director:** "Good question. The reports should highlight:
- Any branch that missed their sales targets
- Significant variance from normal patterns
- Branches with cash close discrepancies
- Missed closings or incomplete data
- Year-over-year declines

These exceptions should be flagged clearly, maybe with color coding or special sections in the report."

**Branch Manager:** "From my perspective, I'd also like to receive my branch's weekly report. It helps me understand how we're performing and what I need to focus on."

**General Director:** "Yes, Branch Managers should automatically get their individual branch reports. They don't need the consolidated corporate report - that's my level of detail."

**System Analyst:** "Should the timing be configurable? What if you want reports on a different day?"

**General Director:** "The default should be Monday mornings at 8 AM, but yes, I should be able to configure:
- Day of week for delivery
- Time of day
- Which reports I receive
- Additional recipients (like my CFO or board members)

I might also want to request an ad-hoc report at any time for a custom date range."

**System Analyst:** "How far back should historical data be available?"

**General Director:** "I should be able to access weekly reports going back at least 2 years. This helps with:
- Year-over-year comparisons
- Seasonal trend analysis
- Long-term performance tracking
- Audit and compliance requirements"

**System Analyst:** "What about visualization? Do you want charts and graphs?"

**General Director:** "Absolutely. The reports should include:
- Sales trend line charts (weekly progression)
- Branch comparison bar charts
- Payment method pie charts
- Year-over-year comparison charts
- Top products tables with visual indicators

Visual data makes it much easier to spot trends and patterns quickly."

**System Analyst:** "Should there be any narrative or insights generated automatically?"

**General Director:** "That would be amazing. If the system could include automatic insights like:
- 'Branch Downtown sales increased 15% compared to last week'
- 'Credit card usage is trending up across all branches'
- 'Weekend sales are 20% higher than weekdays on average'

These insights help me quickly understand what's happening without doing the analysis myself."

**System Analyst:** "What if a branch has incomplete data for the week?"

**General Director:** "The report should still be generated but clearly note:
- Which branches have incomplete data
- What specific data is missing
- Impact on consolidated figures

I don't want to wait for perfect data - I'd rather see what we have with appropriate disclaimers."

**System Analyst:** "How should the system handle failed report generation or delivery?"

**General Director:** "If report generation fails:
- Retry automatically
- Alert the system administrator
- Notify me if it can't be delivered after multiple attempts
- Keep the reports accessible in the system even if email fails

The reports are too important to just silently fail."

### Business Value
- **Strategic Decision Making:** Provides data-driven insights for business strategy
- **Time Efficiency:** Eliminates manual report compilation and consolidation
- **Consistency:** Ensures standardized metrics across all branches
- **Trend Identification:** Enables early detection of opportunities and problems
- **Accountability:** Creates regular performance visibility for all branches
- **Stakeholder Communication:** Facilitates board and investor reporting

---

## Acceptance Criteria (Gherkin Style)

### Scenario 1: Automatically Generate and Deliver Weekly Reports
```gherkin
Feature: Automatic Weekly Reports
  As a General Director
  I want to automatically receive weekly reports per branch and consolidated corporate reports
  So that I can make informed strategic decisions without manual consolidation

Scenario: System automatically generates and emails weekly reports on Monday morning
  Given today is Monday "2026-02-03" at "08:00"
  And the reporting period is the previous week (Monday 2026-01-27 to Sunday 2026-02-02)
  And all 12 branches have complete data for the reporting period
  And the General Director is configured to receive weekly reports
  When the scheduled report generation job runs
  Then the system should generate the following reports:
    | Report Type                     | Count |
    | Individual Branch Reports       | 12    |
    | Consolidated Corporate Report   | 1     |
  And each report should be generated in formats:
    | Format |
    | PDF    |
    | Excel  |
  And an email should be sent to the General Director with:
    | Email Component          | Content                                           |
    | Subject                  | Weekly Performance Report - Week of 2026-01-27    |
    | Executive Summary        | Key highlights and notable metrics                |
    | Attachments              | Consolidated Report (PDF + Excel)                 |
  And individual branch reports should be sent to respective Branch Managers
  And all reports should be saved in the system for future access
```

### Scenario 2: Consolidated Corporate Report Contains All Key Metrics
```gherkin
Scenario: Consolidated report includes comprehensive corporate metrics
  Given the system is generating the weekly consolidated corporate report
  And the reporting period is "2026-01-27 to 2026-02-02"
  And total sales across all branches for the week are:
    | Branch          | Sales      |
    | BR-001          | $15,000    |
    | BR-002          | $18,500    |
    | BR-003 to BR-12 | $120,000   |
    | **Total**       | $153,500   |
  When the consolidated report is generated
  Then it should include the following sections:
    | Section                     | Content                                        |
    | Executive Summary           | Key highlights, trends, and exceptions         |
    | Total Sales                 | $153,500 across all branches                   |
    | Sales by Branch             | Breakdown and ranking of all 12 branches       |
    | Week-over-Week Comparison   | Change vs. previous week (% and $)             |
    | Year-over-Year Comparison   | Change vs. same week last year                 |
    | Payment Method Breakdown    | Cash, Debit, Credit totals and percentages     |
    | Average Transaction Value   | Corporate average and by-branch comparison     |
    | Top 10 Products             | Best sellers across all branches               |
    | Discount Analysis           | Total discounts given, by type and branch      |
    | Exceptions and Alerts       | Underperformance, variances, missing data      |
  And the report should include visualizations for each section
```

### Scenario 3: Individual Branch Report Shows Branch-Specific Metrics
```gherkin
Scenario: Branch Manager receives weekly report for their branch only
  Given the system is generating weekly reports
  And Branch Manager "Jane Smith" manages branch "BR-001 - Toscana Downtown"
  And branch "BR-001" had the following week:
    | Metric                    | Value      |
    | Total Sales               | $15,000    |
    | Transactions              | 450        |
    | Average Transaction       | $33.33     |
    | Cash Sales                | $5,000     |
    | Card Sales                | $10,000    |
    | Total Discounts           | $750       |
  When the weekly report for "BR-001" is generated
  Then Branch Manager "Jane Smith" should receive an email
  And the report should include only data for branch "BR-001"
  And the report should NOT include data from other branches
  And the report should show:
    | Section                          | Details                                |
    | Branch Performance Summary       | Key metrics for BR-001                 |
    | Week-over-Week Trend             | BR-001's performance vs. last week     |
    | Daily Sales Breakdown            | Mon-Sun sales for BR-001               |
    | Top Products at BR-001           | Best sellers at this branch            |
    | Staff Performance                | Transactions per employee              |
    | Discount Usage                   | Discounts applied at BR-001            |
  And the Branch Manager should NOT receive the consolidated corporate report
```

### Scenario 4: Report Highlights Exceptions and Underperformance
```gherkin
Scenario: Consolidated report flags branches with significant issues
  Given the system is generating the weekly consolidated report
  And branch "BR-005" had sales of $8,000 (30% below target of $11,500)
  And branch "BR-007" had 3 daily closes completed late
  And branch "BR-009" had cash discrepancies totaling $150
  When the report is generated
  Then the "Exceptions and Alerts" section should include:
    | Alert Type              | Branch  | Details                                    |
    | Sales Below Target      | BR-005  | 30% below target ($3,500 short)            |
    | Late Cash Closes        | BR-007  | 3 closes completed late this week          |
    | Cash Discrepancies      | BR-009  | Cumulative variance of $150                |
  And these exceptions should be highlighted with color coding (red/yellow)
  And each exception should include a link to detailed data
  And the email summary should mention "3 branches require attention"
```

### Scenario 5: Include Year-over-Year Comparison
```gherkin
Scenario: Report shows comparison to same week last year
  Given the reporting period is "2026-01-27 to 2026-02-02"
  And total sales this week are $153,500
  And sales for the same week last year (2025-01-27 to 2025-02-02) were $142,000
  And the year-over-year growth is 8.1%
  When the consolidated report is generated
  Then it should include a "Year-over-Year Comparison" section showing:
    | Metric              | This Year  | Last Year  | Change   | % Change |
    | Total Sales         | $153,500   | $142,000   | +$11,500 | +8.1%    |
    | Transactions        | 4,500      | 4,200      | +300     | +7.1%    |
    | Avg Transaction     | $34.11     | $33.81     | +$0.30   | +0.9%    |
  And the report should include a trend chart showing weekly sales for the past 12 months
  And positive growth should be highlighted in green
  And negative growth should be highlighted in red
```

### Scenario 6: Generate Ad-Hoc Report for Custom Date Range
```gherkin
Scenario: General Director requests custom report for specific period
  Given I am logged in as the General Director
  And I want to analyze performance for a specific period
  When I navigate to "Reports" > "Generate Custom Report"
  And I select report type "Consolidated Corporate Report"
  And I set the date range to "2026-01-01" to "2026-01-31" (full month)
  And I select format "PDF and Excel"
  And I click "Generate Report"
  Then the system should generate a custom report for January 2026
  And the report should include all standard sections with data for the custom period
  And the report should be available for immediate download
  And the system should offer option to email the report
  And the custom report should be saved in "Custom Reports" archive
```

### Scenario 7: Visualize Sales Trends with Charts
```gherkin
Scenario: Report includes graphical visualizations of key metrics
  Given the weekly consolidated report is being generated
  And sales data for the past 8 weeks is available
  When the report includes visualizations
  Then it should contain the following charts:
    | Chart Type              | Data Displayed                                      |
    | Line Chart              | Weekly sales trend (past 8 weeks)                   |
    | Bar Chart               | Branch comparison (sales by branch)                 |
    | Pie Chart               | Payment method distribution                         |
    | Stacked Bar Chart       | Daily sales breakdown (Mon-Sun)                     |
    | Horizontal Bar Chart    | Top 10 products by revenue                          |
  And all charts should be clearly labeled with axis titles and legends
  And charts should use consistent brand colors
  And charts should be embedded in the PDF version
  And raw data for charts should be in separate sheet in Excel version
```

### Scenario 8: Handle Missing or Incomplete Data
```gherkin
Scenario: Generate report when one branch has incomplete data
  Given today is Monday "2026-02-03" at "08:00"
  And 11 branches have complete data for the week
  And branch "BR-008" is missing Saturday and Sunday sales data
  When the weekly report generation runs
  Then the system should still generate all reports
  And the consolidated report should include a disclaimer:
    """
    Note: Branch BR-008 data incomplete (Sat-Sun missing).
    Corporate totals reflect available data only.
    """
  And branch "BR-008" should be flagged in the branch comparison table
  And the Branch Manager for "BR-008" should be notified of missing data
  And the General Director should see the incomplete branch highlighted
  And estimated impact on corporate totals should be noted if possible
```

### Scenario 9: Configure Report Delivery Preferences
```gherkin
Scenario: General Director customizes report schedule and recipients
  Given I am logged in as the General Director
  When I navigate to "Settings" > "Report Preferences"
  And I configure the following:
    | Setting                    | Value                              |
    | Delivery Day               | Monday                             |
    | Delivery Time              | 08:00                              |
    | Report Format              | PDF and Excel                      |
    | Primary Recipient          | director@toscana.com               |
    | CC Recipients              | cfo@toscana.com, board@toscana.com |
    | Include Individual Reports | No (consolidated only)             |
  And I save the preferences
  Then subsequent weekly reports should be delivered according to these settings
  And both CC recipients should receive the reports
  And individual branch reports should not be included in the email
  And the configuration should be logged for audit purposes
```

### Scenario 10: Access Historical Weekly Reports
```gherkin
Scenario: General Director reviews historical weekly reports
  Given I am logged in as the General Director
  And weekly reports have been generated for the past 24 months
  When I navigate to "Reports" > "Historical Weekly Reports"
  Then I should see a list of all past reports organized by:
    | Organization     |
    | Year             |
    | Month            |
    | Week             |
  And I should be able to filter by:
    | Filter Option         |
    | Date Range            |
    | Report Type           |
    | Branch (for individual reports) |
  When I select the report for "Week of 2025-01-27"
  Then I should be able to view or download it in both PDF and Excel formats
  And I should see a summary preview before downloading
  And I should be able to compare multiple weeks side-by-side
```

---
