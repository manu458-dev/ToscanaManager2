# User Story US-06: Role-Based Authentication and Interface

## User Story Description

**ID:** US-06

**Priority:** High

**User Story:**
As a **User (General Director, Branch Manager, Cashier, Waiter)**, I want to **log into the system using my credentials and be directed to my role-specific interface** so that **I can access only the features and data relevant to my responsibilities**.

---

## Detailed Conversation

### Context
The Toscana Manager 2.0 system serves multiple user roles with different responsibilities and access levels. Each role needs a tailored interface that presents only the features and information relevant to their job function. This improves usability, reduces confusion, and enforces security by design.

### User Needs
**System Analyst:** "Let's discuss how different users should access the system. What's the login process you envision?"

**General Director:** "From my perspective, I need to be able to log in from anywhere - my office, home, or even my mobile device. Once I'm logged in, I should see a dashboard with corporate-level information: consolidated sales across all branches, key performance indicators, alerts about issues at any location."

**Branch Manager:** "For me, the login should be quick and simple. When I log in at my branch, I should immediately see my branch's dashboard - today's sales, staff currently on duty, any pending approvals I need to handle, cash drawer status. I don't want to see data from other branches - that's not my concern."

**Cashier:** "I need to log in fast, especially during busy periods. My screen should just show what I need: the POS interface to process sales, my current cash drawer balance, and maybe a list of current orders. I don't need reports or settings - just the tools to serve customers."

**Waiter:** "When I log in, I need to see my assigned tables and their current status. I don't need access to the cash register or financial reports. My interface should focus on taking orders, sending them to the kitchen, and generating bills for tables."

**System Analyst:** "How should the system handle credentials? Username and password?"

**Branch Manager:** "Yes, each employee should have a unique username and a secure password. We should enforce password requirements:
- Minimum length (at least 8 characters)
- Mix of letters, numbers, and symbols
- Can't be something obvious like '12345678'
- Must be changed periodically (every 90 days)"

**General Director:** "For security, we should also have:
- Account lockout after multiple failed login attempts
- Session timeout after inactivity
- Ability to remotely disable accounts if an employee leaves
- Audit log of all login attempts"

**System Analyst:** "What happens if someone forgets their password?"

**Branch Manager:** "Branch Managers should be able to reset passwords for employees at their branch. For my own password or the General Director's password, we might need a more secure process - maybe security questions or email verification."

**Cashier:** "Sometimes during a rush, I might need to step away for a break and another cashier takes over. Can we quickly switch users without fully logging out?"

**System Analyst:** "So you need a 'quick user switch' or 'lock screen' feature?"

**Branch Manager:** "Yes, that would be helpful. The session should lock but not log out completely, so another cashier can log in to their own session on the same terminal."

**System Analyst:** "Let me clarify what each role should see upon logging in. For the General Director?"

**General Director:** "I should see:
- Corporate dashboard with all branch performance metrics
- Consolidated sales figures
- Branch comparison charts
- Critical alerts (like a branch being offline or missing a cash close)
- Quick access to corporate reports
- Branch management tools
- User management across all branches"

**Branch Manager:** "My dashboard should show:
- My branch's daily sales and performance
- Current staff on duty
- Pending manager approvals (discounts, refunds, etc.)
- Today's scheduled employees
- Cash drawer status
- Branch-specific alerts
- Quick access to branch reports and user management for my branch"

**Cashier:** "I should see:
- POS transaction interface (the main focus)
- My assigned cash drawer and its starting balance
- Current open transactions if any
- Quick access to product catalog
- Simple, uncluttered interface with big buttons for touch screens"

**Waiter:** "My interface should display:
- Table layout with status indicators (occupied, ordered, ready to bill)
- My assigned tables highlighted
- Order entry interface
- Kitchen order status
- Bill generation tools
- Customer complaint/notes entry"

**System Analyst:** "Should mobile devices have different interfaces?"

**General Director:** "The mobile interface should be responsive but might show condensed information. For instance, I might primarily use mobile for viewing reports and checking alerts, not for detailed configuration."

**Branch Manager:** "Mobile is useful for me to check on the branch when I'm not on-site, but cashiers and waiters probably won't use mobile - they'll use dedicated terminals."

**System Analyst:** "What about shift changes? Should there be any special login considerations?"

**Branch Manager:** "At shift change, the outgoing cashier should do a cash register close before logging out. The system should enforce this - maybe show a warning if someone tries to log out with an open cash drawer that hasn't been reconciled."

**Cashier:** "Yes, and when I log in at the start of my shift, the system should prompt me to verify my starting cash drawer amount."

### Business Value
- **Security:** Ensures only authorized users access the system with appropriate privileges
- **Usability:** Role-specific interfaces reduce clutter and improve efficiency
- **Accountability:** Individual logins create clear audit trails
- **Productivity:** Users see only relevant features, reducing training time
- **Compliance:** Meets requirements for user authentication and access control
- **Flexibility:** Supports access from multiple device types

---

## Acceptance Criteria (Gherkin Style)

### Scenario 1: General Director Login with Corporate Dashboard
```gherkin
Feature: Role-Based Authentication and Interface
  As a User with a specific role
  I want to log in with my credentials
  So that I can access my role-specific interface and features

Scenario: General Director successfully logs in and sees corporate dashboard
  Given I am at the login page
  And I have valid General Director credentials:
    | Username  | Password      | Role              |
    | gd.admin  | SecurePass1!  | General Director  |
  When I enter username "gd.admin"
  And I enter password "SecurePass1!"
  And I click "Login"
  Then the system should authenticate my credentials
  And I should be logged in successfully
  And I should be redirected to the "Corporate Dashboard"
  And the dashboard should display:
    | Widget                          | Description                                    |
    | Consolidated Sales Overview     | All branches' sales for today                  |
    | Branch Performance Comparison   | Chart comparing all 12 branches                |
    | Critical Alerts                 | System issues, missing closes, offline branches|
    | Quick Actions                   | Branch Management, User Management, Reports    |
  And I should see navigation options for:
    | Menu Item           |
    | Branch Management   |
    | Corporate Reports   |
    | User Management     |
    | System Settings     |
  And my session should be logged with timestamp and IP address
```

### Scenario 2: Branch Manager Login with Branch-Specific Dashboard
```gherkin
Scenario: Branch Manager logs in and sees branch dashboard
  Given I am at the login page
  And I am a Branch Manager for branch "BR-001 - Toscana Downtown"
  And my credentials are:
    | Username     | Password      | Role            | Branch  |
    | bm.downtown  | BranchPass2!  | Branch Manager  | BR-001  |
  When I log in with username "bm.downtown" and password "BranchPass2!"
  Then I should be redirected to the "Branch Dashboard" for "BR-001"
  And the dashboard should display:
    | Widget                      | Description                                |
    | Today's Sales               | Real-time sales for BR-001 only            |
    | Staff On Duty               | Currently logged-in employees at BR-001    |
    | Pending Approvals           | Discount/refund requests awaiting approval |
    | Cash Drawer Status          | Status of all cash registers               |
    | Branch Alerts               | Branch-specific issues or notifications    |
  And I should see navigation options for:
    | Menu Item               |
    | User Management         |
    | Branch Reports          |
    | Cash Closing            |
    | Branch Settings         |
  And I should NOT see data from other branches
  And I should NOT have access to corporate-level settings
```

### Scenario 3: Cashier Login with POS Interface
```gherkin
Scenario: Cashier logs in and sees POS interface
  Given I am at the login page
  And I am a Cashier at branch "BR-001"
  And my credentials are:
    | Username      | Password       | Role     | Branch  |
    | cashier.john  | CashierPass3!  | Cashier  | BR-001  |
  When I log in with username "cashier.john" and password "CashierPass3!"
  Then I should be redirected to the "POS Interface"
  And the interface should display:
    | Section                | Description                          |
    | Transaction Area       | Current sale items and total         |
    | Product Catalog        | Browse/search products to add        |
    | Payment Options        | Cash, Debit, Credit buttons          |
    | My Cash Drawer         | Starting balance and current status  |
  And I should see a "Start Cash Drawer" prompt if not initialized
  And the interface should be optimized for touch screen interaction
  And I should NOT see:
    | Restricted Features    |
    | Financial Reports      |
    | User Management        |
    | Branch Settings        |
    | Corporate Dashboard    |
```

### Scenario 4: Waiter Login with Table Management Interface
```gherkin
Scenario: Waiter logs in and sees table management interface
  Given I am at the login page
  And I am a Waiter at branch "BR-002"
  And my credentials are:
    | Username       | Password      | Role   | Branch  |
    | waiter.maria   | WaiterPass4!  | Waiter | BR-002  |
  When I log in with username "waiter.maria" and password "WaiterPass4!"
  Then I should be redirected to the "Table Management Interface"
  And the interface should display:
    | Section              | Description                                |
    | Table Layout         | Visual layout of all tables with status    |
    | My Tables            | Tables assigned to me highlighted          |
    | Active Orders        | Orders I've placed that are in progress    |
    | Quick Actions        | Take Order, Generate Bill, Add Notes       |
  And table statuses should be color-coded:
    | Status    | Color  |
    | Available | Green  |
    | Occupied  | Yellow |
    | Ready     | Blue   |
    | Billing   | Orange |
  And I should NOT have access to:
    | Restricted Features  |
    | Cash Register        |
    | Financial Reports    |
    | User Management      |
```

### Scenario 5: Failed Login with Invalid Credentials
```gherkin
Scenario: User attempts to log in with incorrect password
  Given I am at the login page
  And a user exists with username "cashier.john" and password "CashierPass3!"
  When I enter username "cashier.john"
  And I enter password "WrongPassword"
  And I click "Login"
  Then the system should reject the login
  And I should see an error message "Invalid username or password"
  And I should remain on the login page
  And the failed attempt should be logged with:
    | Field          | Value                |
    | Username       | cashier.john         |
    | Timestamp      | [Current timestamp]  |
    | IP Address     | [User's IP]          |
    | Failure Reason | Invalid password     |
  And my account should NOT be locked (first attempt)
```

### Scenario 6: Account Lockout After Multiple Failed Attempts
```gherkin
Scenario: Account is locked after 5 failed login attempts
  Given I am at the login page
  And user "cashier.john" exists
  And there have been 4 previous failed login attempts for "cashier.john"
  When I enter username "cashier.john"
  And I enter an incorrect password
  And I click "Login"
  Then the system should lock the account "cashier.john"
  And I should see an error message "Account locked due to multiple failed login attempts. Please contact your manager."
  And the account status should be changed to "Locked"
  And the lockout should be logged
  And subsequent login attempts with correct password should also be rejected until unlock
```

### Scenario 7: Session Timeout After Inactivity
```gherkin
Scenario: User session expires after 30 minutes of inactivity
  Given I am logged in as a Cashier
  And I am viewing the POS interface
  And the session timeout is set to 30 minutes
  When I have no activity for 30 minutes
  Then the system should automatically log me out
  And I should see a message "Your session has expired due to inactivity. Please log in again."
  And I should be redirected to the login page
  And any unsaved work should be preserved if possible
  And the session end should be logged with reason "Timeout"
```

### Scenario 8: Password Reset by Branch Manager
```gherkin
Scenario: Branch Manager resets employee password
  Given I am logged in as a Branch Manager for branch "BR-001"
  And employee "cashier.john" is assigned to branch "BR-001"
  And "cashier.john" has forgotten their password
  When I navigate to User Management
  And I select employee "cashier.john"
  And I click "Reset Password"
  And I generate a temporary password "TempPass123!"
  And I confirm the password reset
  Then the system should reset "cashier.john"'s password to "TempPass123!"
  And "cashier.john" should be required to change password on next login
  And the password reset should be logged with:
    | Field         | Value                    |
    | User          | cashier.john             |
    | Reset By      | [Branch Manager ID]      |
    | Timestamp     | [Current timestamp]      |
    | Reason        | Password forgotten       |
  And I should be able to communicate the temporary password to "cashier.john"
```

### Scenario 9: Quick User Switch Without Full Logout
```gherkin
Scenario: Cashier locks session for coworker to use same terminal
  Given I am logged in as "cashier.john" at terminal "POS-01"
  And I need to take a break
  And another cashier "cashier.susan" will use this terminal
  When I click "Lock Session"
  Then my session should be suspended
  And the system should show the login screen
  And my transaction data should be preserved
  When "cashier.susan" logs in with her credentials
  Then she should access her own POS interface with her own cash drawer
  And my session should remain suspended in the background
  When "cashier.susan" logs out
  And I log back in
  Then I should return to my previous session state
  And my transaction data should still be available
```

### Scenario 10: Enforce Password Requirements
```gherkin
Scenario: System enforces strong password requirements during password change
  Given I am logged in as a Cashier
  And I am required to change my password
  When I navigate to "Change Password"
  And I attempt to set password "12345678"
  Then the system should reject it with message "Password must contain letters, numbers, and special characters"
  When I attempt to set password "Pass1!"
  Then the system should reject it with message "Password must be at least 8 characters"
  When I attempt to set password "Password1!"
  And this password has been used before
  Then the system should reject it with message "Cannot reuse previous passwords"
  When I set password "NewSecure1!"
  And the password meets all requirements:
    | Requirement              | Met |
    | Minimum 8 characters     | Yes |
    | Contains letters         | Yes |
    | Contains numbers         | Yes |
    | Contains special chars   | Yes |
    | Not previously used      | Yes |
  Then the password should be accepted and updated
  And I should see confirmation "Password changed successfully"
```

---
